# 装备系统和掉落系统重构计划

## 一、问题分析

### 当前系统存在的问题

1. **装备等级混乱**
   - 装备等级从1到80级，分布不规律
   - 没有明确的档次划分
   - 部分等级区间装备过少或过多

2. **属性分配混乱**
   - 同等级装备属性差异大
   - 散件和套装属性没有明确的优劣关系
   - 三职业(战士/法师/道士)属性分配复杂

3. **掉落系统混乱**
   - 掉落组按装备类型(low/mid/high)划分，不够清晰
   - 掉落率跨度大(1/30到1/2800)
   - 套装掉落组过于分散

4. **职业系统复杂**
   - 三职业(战士/法师/道士)导致装备配置复杂
   - 道士装备相对较少

## 二、改造目标

### 1. 装备等级划分
- 每5级为一个档次
- 等级档位：1-5, 6-10, 11-15, 16-20, 21-25, 26-30, 31-35, 36-40, 41-45, 46-50, 51-55, 56-60, 61-65, 66-70, 71-75, 76-80
- 共16个档次

### 2. 装备类型
- 简化为两职业：**战士类** 和 **魔法类**
- 每个档次包含：
  - 散件装备（属性更高）
  - 套装装备（9件套，收集加成）

### 3. 属性规则
- 同等级散件属性 > 套装单件属性（约高20-30%）
- 属性随等级线性增长
- 套装加成提供额外特效和属性

### 3.1 装备属性完整性规则（必须遵守）
- **所有装备必须有攻击或魔法加成**：不管是武器还是防具，都必须提供攻击力或魔法力加成
- **攻击系装备(战士)也要有少量MP加成**：战士装备提供HP为主，但也需要少量MP（约为法师装备MP的25%）
- **魔法系装备(法师)也要有少量HP加成**：法师装备提供MP为主，但也需要少量HP（约为战士装备HP的25%）
- **双防属性**：战士装备有物防为主+少量魔御，法师装备有魔御为主+少量物防

### 4. 掉落系统
- 按装备档次分配副本掉落
- 每个档次掉落率递减
- 高级副本掉落高档次装备

## 三、装备等级档次设计

### 装备槽位
| 槽位 | 数量 |
|------|------|
| 武器 | 1 |
| 头盔 | 1 |
| 胸甲 | 1 |
| 腰带 | 1 |
| 鞋子 | 1 |
| 项链 | 1 |
| 戒指 | 2 |
| 手镯 | 2 |

### 每个档次装备配置

#### 1-5级（新手档）
- **散件**（5种）：木剑、布衣、皮帽、皮带、皮靴
- **套装**（无）

#### 6-10级
- **散件**（5种）：铁剑、铁甲、铁盔、铁腰带、铁靴
- **套装**：新手套装(9件)

#### 11-15级
- **散件**（5种）
- **套装**：丛林套装(战士)/秘法套装(魔法)

#### 16-20级
- **散件**（5种）
- **套装**：勇气套装(战士)/光辉套装(魔法)

#### 21-25级
- **散件**（5种）
- **套装**：守护套装(战士)/奥秘套装(魔法)

#### 26-30级
- **散件**（5种）
- **套装**：熔火套装(战士)/奥术套装(魔法)

#### 31-35级
- **散件**（5种）
- **套装**：烈焰套装(战士)/寒冰套装(魔法)

#### 36-40级
- **散件**（5种）
- **套装**：勇者套装(战士)/魔能套装(魔法)

#### 41-45级
- **散件**（5种）
- **套装**：龙鳞套装(战士)/灵风套装(魔法)

#### 46-50级
- **散件**（5种）
- **套装**：雷霆套装(战士)/虚空套装(魔法)

#### 51-55级
- **散件**（5种）
- **套装**：圣光套装(战士)/暗影套装(魔法)

#### 56-60级
- **散件**（5种）
- **套装**：冰冠套装(战士)/巫妖套装(魔法)

#### 61-65级
- **散件**（5种）
- **套装**：风暴套装(战士)/熔岩套装(魔法)

#### 66-70级
- **散件**（5种）
- **套装**：奥术战铠/奥术秘法

#### 71-75级
- **散件**（5种）
- **套装**：深渊套装(战士)/深渊魔纹(魔法)

#### 76-80级（最高档）
- **散件**（5种）：神器级散件
- **套装**：终极套装(战士)/终极套装(魔法)
- **橙色传说装备**：8件橙装

## 四、属性计算公式

### 基础属性公式

#### 战士类装备
```
等级档位 = ceil(装备等级 / 5)

武器：
  攻击力 = 等级档位 * 8 ± 20%
  MP加成 = 等级档位 * 10（法师装备MP的25%）

防具：
  攻击力 = 等级档位 * 2（武器攻击的25%）
  防御力 = 等级档位 * 5 ± 20%
  魔御力 = 等级档位 * 3（物防的60%）
  HP加成 = 等级档位 * 30 ± 20%
  MP加成 = 等级档位 * 10（法师装备MP的25%）
```

#### 魔法类装备
```
武器：
  魔法力 = 等级档位 * 10 ± 20%
  MP加成 = 等级档位 * 40 ± 20%
  HP加成 = 等级档位 * 8（战士装备HP的约25%）

防具：
  魔法力 = 等级档位 * 2.5（武器魔法的25%）
  魔御力 = 等级档位 * 6 ± 20%
  防御力 = 等级档位 * 3（魔御的50%）
  MP加成 = 等级档位 * 40 ± 20%
  HP加成 = 等级档位 * 8（战士装备HP的约25%）
```

### 散件 vs 套装属性对比
| 类型 | 属性倍率 | 特效 |
|------|----------|------|
| 散件 | 1.0 | 基础特效1-2个 |
| 套装单件 | 0.75 | 基础特效1个 |
| 套装2件 | +20% | 无额外特效 |
| 套装4件 | +50% | 额外特效1个 |
| 套装6件 | +100% | 额外特效2个 |
| 套装8件 | +150% | 额外特效3个 |
| 套装9件 | +200% | 终极特效1个 |

### 属性示例（以30级战士武器为例）
- **散件**：攻击力 48-58 (30级=6档 × 8 = 48)
- **套装单件**：攻击力 36-43 (48 × 0.75)
- **套装9件加成**：额外攻击力 96 (48 × 2)

## 五、副本与掉落配置

### 副本等级划分

| 副本等级 | 副本名称 | 装备档次 | 掉落率 |
|----------|----------|----------|--------|
| 1-10 | 沃玛森林/僵尸洞1层 | 1-2档 | 1/20 |
| 11-20 | 沃玛寺庙/僵尸洞2-3层 | 3-4档 | 1/50 |
| 21-30 | 猪洞/祖玛寺庙1-3层 | 5-6档 | 1/100 |
| 31-40 | 祖玛4-5层/封魔谷 | 7-8档 | 1/200 |
| 41-50 | 赤月峡谷/黑暗森林 | 9-10档 | 1/400 |
| 51-60 | 崔斯特瑞姆/熔火之心 | 11-12档 | 1/800 |
| 61-70 | 黑石深渊/安其拉 | 13-14档 | 1/1500 |
| 71-80 | 70级副本群 | 15-16档 | 1/3000 |

### 掉落组结构

```json
{
  "tier_1_5": {
    "name": "1-5级装备",
    "drops": [
      {"item": "wooden_sword", "rate": "1/30"},
      {"item": "cloth_armor", "rate": "1/30"}
    ]
  },
  "tier_6_10": {
    "name": "6-10级装备",
    "drops": [
      {"item": "iron_sword", "rate": "1/50"},
      {"item": "novice_helm_warrior", "rate": "1/80"}
    ]
  },
  ...
}
```

### Boss掉落特殊配置
- 普通Boss掉落：对应档次散件 + 套装部件
- 精英Boss掉落：对应档次全部散件 + 套装部件 + 橙装碎片
- 最终Boss掉落：橙装

## 六、文件改造清单

### 需要修改的文件

1. **装备数据文件**
   - `data/items/weapons.json` - 重写所有武器
   - `data/items/armors.json` - 重写所有防具
   - `data/items/accessories.json` - 重写所有饰品
   - `data/items/set_items.json` - 重写所有套装装备

2. **配置文件**
   - `data/config/sets.json` - 重写套装配置
   - `data/config/drop_groups.json` - 重写掉落组
   - `data/monsters/monsters.json` - 更新怪物掉落关联
   - `data/maps/maps.json` - 确认副本等级配置

3. **品质系统**（保持不变）
   - `data/config/quality.json` - 现有品质系统保留

### 新增文件
- `data/config/equipment_tiers.json` - 装备档次配置
- `data/config/drop_zones.json` - 副本掉落配置

## 七、实施步骤

### 第一阶段：装备数据准备
1. 创建装备档次配置文件
2. 生成所有散件装备数据
3. 生成所有套装装备数据
4. 生成套装效果配置

### 第二阶段：掉落系统重构
1. 按档次重新组织掉落组
2. 为每个副本分配对应掉落组
3. 更新怪物掉落关联

### 第三阶段：数据验证
1. 检查所有装备等级连续性
2. 验证属性公式正确性
3. 测试掉落率合理性

### 第四阶段：代码适配
1. 检查后端代码是否需要修改
2. 更新职业系统为两职业
3. 更新UI显示

## 八、注意事项

1. **向后兼容性**：本次重构为完全重做，不保留旧数据
2. **测试**：每个档次都需要在游戏中测试掉落和穿戴
3. **平衡性**：可能需要根据实际游戏体验调整掉落率
4. **橙装**：8件橙装保持现有设计，仅调整等级到对应档次

## 九、改造后的装备数量统计

- **散件**：16档次 × 5种 × 2职业 = 160件
- **套装**：14档次 × 9件 × 2职业 = 252件
- **橙装**：8件
- **总计**：约420件装备（相比现有更精简）

## 十、时间估算

| 阶段 | 预计工作量 |
|------|------------|
| 装备数据生成 | 2-3小时 |
| 掉落系统配置 | 1-2小时 |
| 代码适配修改 | 1-2小时 |
| 测试调试 | 1-2小时 |
| **总计** | **5-9小时** |

---

*本计划文件创建于 2026-02-05*
